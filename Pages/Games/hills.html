<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeQuest ‚Äî HTML Hills</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/src/styles/input.css">
    <link rel="stylesheet" href="/src/styles/output.css">
    <link rel="stylesheet" href="/src/styles/main.css">
    <link rel="stylesheet" href="/src/styles/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tiny5&display=swap"
      rel="stylesheet">
    <link rel="icon" type="image/png" href="/icons/CQ-bg.png">
    <!-- <style>
    textarea { font-family: monospace; }
    iframe { background: white; }
  </style> -->
  </head>

  <body class="bg-slate-950 text-slate-100 max-w-7xl mx-auto p-6 space-y-4">
    <header id="header"
      class="header flex justify-between items-center px-6 py-4 bg-purple-950/80 shadow-lg z-50"></header>
    <!-- Left Panel: Dialogue + Quest -->
    <div class="bg-slate-900 p-4 overflow-y-auto rounded-2xl">
      <a href="/Pages/Dashboard/Dashboard.html"><button
          class="px-3 py-1 rounded bg-slate-800 float-right">‚Üê
          Dashboard</button></a>
      <h1 class="text-xl font-bold mb-2">üèûÔ∏è HTML Hills</h1>
      <div id="dialogueBox" class="mb-4 space-y-2"></div>
      <div id="questBox">
        <h2 id="questTitle" class="text-lg font-bold"></h2>
        <p id="questText" class="mt-2"></p>
        <button id="hintBtn"
          class="mt-2 px-2 py-1 bg-emerald-500/80 text-slate-900 rounded">Hint</button>
        <p id="hint" class="hidden text-emerald-300 mt-2"></p>
      </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">

      <!-- Code Editor -->
      <div class="bg-slate-950 ">
        <textarea id="editor"
          class="p-3 w-full h-96 bg-gray-800 text-green-300 font-mono rounded resize-none"></textarea>
      </div>

      <!-- Right Panel: Preview -->
      <div class="">
        <iframe id="preview"
          class="bg-[url('/images/bright.jpg')] w-full h-96 border rounded"></iframe>
      </div>
    </div>

    <!-- Controls -->
    <div
      class=" bottom-0 left-0 right-0 bg-slate-900 p-2 flex justify-between">
      <button id="prevBtn"
        class="px-3 py-1 bg-slate-700 rounded hover:bg-emerald-500">‚¨Ö
        Prev</button>
      <div class="flex gap-2">
        <button id="runBtn"
          class="px-3 py-1 bg-sky-500 text-slate-900 rounded hover:bg-emerald-600">Run</button>
        <button id="submitBtn"
          class="px-3 py-1 bg-emerald-500 text-slate-900 rounded hover:bg-cyan-700">Submit</button>
        <button id="nextBtn"
          class="px-3 py-1 bg-slate-600 rounded hover:bg-emerald-500"
          disabled>Next ‚û°</button>
      </div>
    </div>
    <script src="/scripts/Sections/Navbar.js"></script>
    <script>
    const QUESTS = [
      {
        title: "Rune of the Block",
        text: "Summon your first heading with the <h1> rune.",
        hint: "<h1>Hello Codeoria</h1>",
        dialogue: [
          { speaker: "Master", line: "Apprentice, every story begins with a title. Show me a great heading." },
          { speaker: "You", line: "I will weave the <h1> rune to mark the beginning!" }
        ],
        check: (code)=> code.includes("<h1>")
      },
      {
        title: "Rune of Links",
        text: "Forge a pathway with <a>. Link to 'https://example.com'.",
        hint: "<a href='https://example.com'>Visit</a>",
        dialogue: [
          { speaker: "Master", line: "The Web of Worlds is held by paths. Can you forge one?" },
          { speaker: "You", line: "Yes Master, I shall weave a rune that opens the way." }
        ],
        check: (code)=> code.includes("<a>s")
      }
      // add more quests here...
    ];

    const realmName = "HTML Hills";
    let current = 0;

    const titleEl = document.getElementById("questTitle");
    const textEl = document.getElementById("questText");
    const hintEl = document.getElementById("hint");
    const editor = document.getElementById("editor");
    const preview = document.getElementById("preview");
    const dialogueBox = document.getElementById("dialogueBox");
    const nextBtn = document.getElementById("nextBtn");

    function loadQuest(i){
      current = i;
      const q = QUESTS[i];
      titleEl.textContent = q.title;
      textEl.textContent = q.text;
      hintEl.textContent = q.hint;
      hintEl.classList.add("hidden");
      editor.value = "";
      preview.srcdoc = "";
      renderDialogue(q.dialogue);
      nextBtn.disabled = true;
      saveProgress(false);
    }

    function renderDialogue(lines){
      dialogueBox.innerHTML = "";
      lines.forEach(d=>{
        const p = document.createElement("p");
        p.innerHTML = `<span class="font-bold ${d.speaker==='Master'?'text-emerald-400':'text-sky-400'}">${d.speaker}:</span> ${d.line}`;
        dialogueBox.appendChild(p);
      });
    }

    function runCode(){ preview.srcdoc = editor.value; }

    function submitCode(){
      const code = editor.value;
      const q = QUESTS[current];
      if(q.check(code)){
        alert("‚úÖ Well done, Apprentice!");
        nextBtn.disabled = false;
        saveProgress(true);
      } else {
        alert("‚ùå The weave falters... try again.");
      }
    }

    function saveProgress(markComplete){
      const raw = localStorage.getItem("codequest_dashboard_v1") || "{}";
      const state = JSON.parse(raw);
      state.completed = state.completed || {};
      state.completed[realmName] = state.completed[realmName] || [];
      if(markComplete && !state.completed[realmName].includes(current)){
        state.completed[realmName].push(current);
      }
      localStorage.setItem("codequest_dashboard_v1", JSON.stringify(state));
    }

    document.getElementById("runBtn").onclick = runCode;
    document.getElementById("submitBtn").onclick = submitCode;
    document.getElementById("nextBtn").onclick = ()=> {
      if(current < QUESTS.length-1) loadQuest(current+1);
      else alert("üåü You have mastered the HTML Hills!");
    };
    document.getElementById("prevBtn").onclick = ()=> { if(current>0) loadQuest(current-1); };
    document.getElementById("hintBtn").onclick = ()=> hintEl.classList.toggle("hidden");

    loadQuest(0);
  </script>
  </body>
</html>
